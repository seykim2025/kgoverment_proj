// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 회사 정보 모델
model Company {
  id                    String   @id @default(cuid())
  // 기본 정보
  businessNumber        String   @unique  // 사업자등록번호
  companyName           String             // 회사명
  representativeName    String             // 대표자명
  foundedDate           DateTime           // 설립일
  address               String             // 소재지
  
  // 기업 형태
  companyType           String             // 법인/개인
  companyScale          String             // 중소/벤처/이노비즈 등
  
  // 재무 정보
  recentRevenue         Float?             // 최근 매출액 (억원)
  debtRatio             Float?             // 부채비율 (%)
  
  // 인력/역량
  researcherCount       Int?               // 상근 연구 인력 수
  patentCount           Int?               // 특허 보유 수
  
  // 기술 역량
  technologies          String?            // 보유 기술 (콤마 구분)
  certifications        String?            // 인증 현황 (ISO, 벤처인증 등)
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  projectHistories      ProjectHistory[]
  assessments           Assessment[]
}

// 과거 수행 과제 모델
model ProjectHistory {
  id              String   @id @default(cuid())
  projectName     String             // 과제명
  managingAgency  String             // 주관기관
  performPeriod   String             // 수행기간 (예: 2023.01 ~ 2023.12)
  role            String             // 역할 (주관/참여)
  budget          Float?             // 예산 (억원)
  result          String             // 결과 (성공/실패/진행중)
  summary         String?            // 요약
  keywords        String?            // 기술 키워드 (콤마 구분)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
}

// AI 판단 결과 모델
model Assessment {
  id              String   @id @default(cuid())
  
  // 공고문 정보
  noticeTitle     String             // 공고명
  noticeContent   String             // 공고문 전문 (파싱된 텍스트)
  pdfPath         String?            // 원본 PDF 경로
  
  // 적격성 필터링 결과
  eligibilityStatus     String       // PASS / FAIL / CONDITIONAL
  eligibilityFailReason String?      // 실패 사유
  
  // 정량적 역량 평가
  quantitativeScore     Float?       // 예상 정량 점수
  quantitativeStrengths String?      // 강점 (JSON array)
  quantitativeWeaknesses String?     // 약점 (JSON array)
  
  // 정성적 기술 적합성
  qualitativeRelevanceScore Float?   // 0~100점
  qualitativeReasoning      String?  // 매칭 분석 설명
  qualitativeKeywords       String?  // 매칭 키워드 (JSON array)
  
  // 최종 판정
  trafficLight    String             // GREEN / YELLOW / RED
  summary         String?            // 종합 심사평
  
  // AI 응답 원본
  rawAiResponse   String?            // 전체 AI 응답 (JSON)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
}
